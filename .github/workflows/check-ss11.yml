name: Torchlight SS11 Monitor

on:
  schedule:
    - cron: '*/10 * * * *'
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check announcement and send WeChat
        env:
          SENDKEY: ${{ secrets.SENDKEY }}
        run: "python3 -c \"import requests, os, sys; d = requests.get('https://website.xdcdn.net/form/website/torchlight/news_cn.json', timeout=10).json(); a = d['zh-cn']['announcement'][0]; cid = a['link'].split('id=')[-1]; title = a['title']; link = a['link']; last_id = 'buYaN1rB'; if cid != last_id and ('SS11' in title or 'æ¸´ç˜¾ç—‡' in title): msg = f'æ ‡é¢˜ï¼š{title}\\n\\né“¾æ¥ï¼š{link}'; requests.post(f'https://sctapi.ftqq.com/{os.getenv(\\\"SENDKEY\\\")}.send', data={'title': 'ğŸ”¥ SS11å…¬å‘Šå‘å¸ƒï¼', 'desp': msg}); print('Sent!'); else: print('No update.');\""
