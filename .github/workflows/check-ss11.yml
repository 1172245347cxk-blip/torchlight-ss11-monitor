name: ğŸ”” ç«ç‚¬ä¹‹å…‰ SS11 ç›‘æ§ï¼ˆæ¯10åˆ†é’Ÿå°è¯•ï¼‰

on:
  # æ³¨æ„ï¼šGitHub å®é™…ä¸ä¼šä¸¥æ ¼æ¯10åˆ†é’Ÿè¿è¡Œï¼Œå…è´¹è´¦æˆ·é€šå¸¸æ¯å°æ—¶1æ¬¡
  schedule:
    - cron: '*/10 * * * *'  # æ¯10åˆ†é’Ÿï¼ˆUTCæ—¶é—´ï¼‰
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ•’ åŒ—äº¬æ—¶é—´
        run: echo "å½“å‰åŒ—äº¬æ—¶é—´: $(TZ='Asia/Shanghai' date)"

      - name: ğŸ“¡ æ£€æŸ¥å…¬å‘Šï¼ˆæ¯10åˆ†é’Ÿé€»è¾‘ï¼‰
        env:
          SENDKEY: ${{ secrets.SENDKEY }}
        run: |
          python3 <<'EOF'
          import requests, os, sys, time

          JSON_URL = "https://website.xdcdn.net/form/website/torchlight/news_cn.json"
          LAST_ID = "buYaN1rB"

          try:
              data = requests.get(JSON_URL, timeout=10).json()
              latest = data["zh-cn"]["announcement"][0]
              curr_id = latest["link"].split("id=")[-1]
              title = latest["title"]
              link = latest["link"]

              print(f"ID: {curr_id} | Title: {title}")

              if curr_id != LAST_ID and ("SS11" in title or "æ¸´ç˜¾ç—‡" in title):
                  print("ğŸ‰ å‘ç° SS11 å…¬å‘Šï¼")
                  msg = f"æ ‡é¢˜ï¼š{title}\\n\\né“¾æ¥ï¼š{link}"
                  resp = requests.post(
                      f"https://sctapi.ftqq.com/{os.getenv('SENDKEY')}.send",
                      data={"title": "ğŸ”¥ SS11å…¬å‘Šå‘å¸ƒï¼", "desp": msg}
                  )
                  print("æ¨é€ç»“æœ:", resp.status_code)
              else:
                  print("â„¹ï¸ æ— æ–°å…¬å‘Š")

          except Exception as e:
              print("âŒ é”™è¯¯:", e)
              sys.exit(1)
          EOF
